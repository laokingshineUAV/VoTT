{"version":3,"file":"TelemetryContext.js","sourceRoot":"","sources":["../src/TelemetryContext.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * PropertiesPlugin.ts\r\n * @copyright Microsoft 2018\r\n */\r\n\r\nimport { ITelemetryItem, IDiagnosticLogger } from '@microsoft/applicationinsights-core-js';\r\nimport { Session, _SessionManager } from './Context/Session';\r\nimport { Extensions, ITelemetryContext, IOperatingSystem, ITelemetryTrace, IWeb, SampleRate, CtxTagKeys, SDKExtensionKeys } from '@microsoft/applicationinsights-common';\r\nimport { Application } from './Context/Application';\r\nimport { Device } from './Context/Device';\r\nimport { Internal } from './Context/Internal';\r\nimport { Sample } from './Context/Sample';\r\nimport { User } from './Context/User';\r\nimport { Location } from './Context/Location';\r\nimport { ITelemetryConfig } from './Interfaces/ITelemetryConfig';\r\nimport { TelemetryTrace } from './Context/TelemetryTrace';\r\n \r\nexport class TelemetryContext implements ITelemetryContext {\r\n\r\n    public application: Application; // The object describing a component tracked by this object - legacy\r\n    public device: Device; // The object describing a device tracked by this object.\r\n    public location: Location; // The object describing a location tracked by this object -legacy\r\n    public telemetryTrace: TelemetryTrace; // The object describing a operation tracked by this object.\r\n    public user: User; // The object describing a user tracked by this object.\r\n    public internal: Internal; // legacy\r\n    public session: Session; // The object describing a session tracked by this object.\r\n    public sessionManager: _SessionManager; // The session manager that manages session on the base of cookies.\r\n    public sample: Sample;\r\n    public os: IOperatingSystem;\r\n    public web: IWeb;\r\n\r\n    constructor(logger: IDiagnosticLogger, defaultConfig: ITelemetryConfig) {\r\n        if (typeof window !== 'undefined') {\r\n            this.sessionManager = new _SessionManager(defaultConfig, logger);\r\n            this.application = new Application();\r\n            this.device = new Device();\r\n            this.internal = new Internal(defaultConfig);\r\n            this.location = new Location();\r\n            this.user = new User(defaultConfig, logger);\r\n            this.telemetryTrace = new TelemetryTrace();\r\n            this.session = new Session();\r\n            this.sample = new Sample(defaultConfig.samplingPercentage(), logger);\r\n        }\r\n    }\r\n    \r\n    public applySessionContext(event: ITelemetryItem) {\r\n        let sessionContext = this.session || this.sessionManager.automaticSession;\r\n        if (sessionContext) {\r\n            if (typeof sessionContext.id === \"string\") {\r\n                event.ext.app.sesId = sessionContext.id;\r\n            }\r\n        }\r\n\r\n        if (this.session) {\r\n            // If customer set session info, apply his context; otherwise apply context automatically generated \r\n            if (typeof this.session.id === \"string\") {\r\n                event.ext.app.sesId = this.session.id;\r\n            } else {\r\n                event.ext.app.sesId = this.sessionManager.automaticSession.id;\r\n            }\r\n        }\r\n    }\r\n\r\n    public applyOperatingSystemContxt(event: ITelemetryItem) {\r\n        if (this.os && this.os.name) {\r\n            event.ext.os = this.os;\r\n        }\r\n    }\r\n\r\n    public applyApplicationContext(event: ITelemetryItem) {\r\n        if (this.application) {\r\n\r\n            if (typeof this.application.ver === \"string\") {\r\n                event.tags.push({[CtxTagKeys.applicationVersion]: this.application.ver});\r\n            }\r\n            if (typeof this.application.build === \"string\") {\r\n                event.tags.push({[CtxTagKeys.applicationBuild]: this.application.build });\r\n            }\r\n        }\r\n    }\r\n\r\n    public applyDeviceContext(event: ITelemetryItem) {\r\n\r\n        if (this.device) {\r\n\r\n            if (typeof this.device.id === \"string\") {\r\n                event.ext.device.localId = this.device.id;\r\n            }\r\n\r\n            if (typeof this.device.ip === \"string\") {\r\n                event.ext.device.ip = this.device.ip;\r\n            }\r\n\r\n            if (typeof this.device.model === \"string\") {\r\n                event.ext.device.model = this.device.model;\r\n            }\r\n\r\n            if (typeof this.device.deviceClass === \"string\") {\r\n                event.ext.device.deviceClass = this.device.deviceClass;\r\n            }\r\n        }\r\n    }\r\n\r\n    public applyInternalContext(event: ITelemetryItem) {\r\n        if (this.internal) {\r\n            if (typeof this.internal.agentVersion === \"string\") {\r\n                event.tags.push({[CtxTagKeys.internalAgentVersion]: this.internal.agentVersion }); // not mapped in CS 4.0\r\n            }\r\n            if (typeof this.internal.sdkVersion === \"string\") {\r\n                event.tags.push({[CtxTagKeys.internalSdkVersion]: this.internal.sdkVersion });\r\n            } else {\r\n                // store the version provided by core\r\n                if (event[Extensions.SDKExt] && event[Extensions.SDKExt][SDKExtensionKeys.libVer]) { // not exposing context object as this ext is not finalized\r\n                    event.tags.push({[CtxTagKeys.internalSdkVersion]: event[Extensions.SDKExt][SDKExtensionKeys.libVer] }); // map sdk.libVer \r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public applyLocationContext(event: ITelemetryItem) {\r\n        if (this.location) {\r\n            if (typeof this.location.ip === \"string\") {                \r\n                event.tags.push({[CtxTagKeys.locationIp]: this.location.ip});\r\n            }\r\n        }\r\n    }\r\n\r\n    public applySampleContext(event: ITelemetryItem) {\r\n        if (this.sample) {\r\n            event.tags.push({ SampleRate:  this.sample.sampleRate }); // tags.sampleRate -> mapped in CS 4.0\r\n        }\r\n    }\r\n\r\n    public applyOperationContext(event: ITelemetryItem) {\r\n        if (this.telemetryTrace) {\r\n            let trace = event.ext.trace || <ITelemetryTrace>{traceID: undefined, parentID: undefined};\r\n            if (typeof this.telemetryTrace.traceID === \"string\") {\r\n                trace.traceID = this.telemetryTrace.traceID;\r\n            }\r\n\r\n            if (typeof this.telemetryTrace.name === \"string\") {\r\n                trace.name = this.telemetryTrace.name;\r\n            }\r\n            \r\n            if (typeof this.telemetryTrace.parentID === \"string\") {\r\n                trace.parentID = this.telemetryTrace.parentID;\r\n            }\r\n\r\n            event.ext.trace = trace;\r\n        }\r\n    }\r\n\r\n    public applyWebContext(event: ITelemetryItem) {\r\n        if (this.web) {\r\n            event.ext.web = event.ext.web || {};\r\n            event.ext.web = this.web;\r\n        }\r\n    }\r\n\r\n    public applyUserContext(event: ITelemetryItem) {\r\n        if (this.user) {\r\n            if (!event.tags) {\r\n                event.tags = [];\r\n            }\r\n            \r\n            // stays in tags\r\n            if (typeof this.user.accountId === \"string\") {\r\n                let item = {};\r\n                event.tags.push({[CtxTagKeys.userAccountId]: this.user.accountId});\r\n            }\r\n            \r\n            // CS 4.0            \r\n            if (typeof this.user.id === \"string\") {\r\n                event.ext.user.id = this.user.id;\r\n            }\r\n            \r\n            if (typeof this.user.authenticatedId === \"string\") {\r\n                event.ext.user.authId = this.user.authenticatedId;\r\n            }            \r\n        }\r\n    }\r\n\r\n    public cleanUp(event:ITelemetryItem) {\r\n        if (event.ext[Extensions.DeviceExt] && Object.keys(event.ext[Extensions.DeviceExt]).length === 0) {\r\n            delete event.ext[Extensions.DeviceExt];\r\n        }\r\n        if (event.ext[Extensions.UserExt] && Object.keys(event.ext[Extensions.UserExt]).length === 0) {\r\n            delete event.ext[Extensions.UserExt];\r\n        }\r\n        if (event.ext[Extensions.WebExt] && Object.keys(event.ext[Extensions.WebExt]).length === 0) {\r\n            delete event.ext[Extensions.WebExt];\r\n        }\r\n        if (event.ext[Extensions.OSExt] && Object.keys(event.ext[Extensions.OSExt]).length === 0) {\r\n            delete event.ext[Extensions.OSExt];\r\n        }\r\n        if (event.ext[Extensions.AppExt] && Object.keys(event.ext[Extensions.AppExt]).length === 0) {\r\n            delete event.ext[Extensions.AppExt];\r\n        }\r\n        if (event.ext[Extensions.TraceExt] && Object.keys(event.ext[Extensions.TraceExt]).length === 0) {\r\n            delete event.ext[Extensions.TraceExt];\r\n        }\r\n    }\r\n}"]}