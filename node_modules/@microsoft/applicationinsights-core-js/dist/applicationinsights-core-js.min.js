/*!
 * Application Insights JavaScript SDK - Core, 2.0.0-beta.4
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.Microsoft=e.Microsoft||{},e.Microsoft.ApplicationInsights={}))}(this,function(a){"use strict";var e,t={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},f=function(){function e(){}return e.isNullOrUndefined=function(e){return null==e},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(i,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}(),i=/[xy]/g,u=function(){function e(){this.listeners=[]}return e.prototype.addNotificationListener=function(e){this.listeners.push(e)},e.prototype.removeNotificationListener=function(e){for(var t=this.listeners.indexOf(e);-1<t;)this.listeners.splice(t,1),t=this.listeners.indexOf(e)},e.prototype.eventsSent=function(t){for(var i=this,e=function(e){n.listeners[e].eventsSent&&setTimeout(function(){return i.listeners[e].eventsSent(t)},0)},n=this,o=0;o<this.listeners.length;++o)e(o)},e.prototype.eventsDiscarded=function(t,i){for(var n=this,e=function(e){o.listeners[e].eventsDiscarded&&setTimeout(function(){return n.listeners[e].eventsDiscarded(t,i)},0)},o=this,r=0;r<this.listeners.length;++r)e(r)},e}();(e=a.LoggingSeverity||(a.LoggingSeverity={}))[e.CRITICAL=1]="CRITICAL",e[e.WARNING=2]="WARNING";var s={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69},l=function(){function r(e,t,i,n){void 0===i&&(i=!1),this.messageId=e,this.message=(i?r.AiUserActionablePrefix:r.AiNonUserActionablePrefix)+e;var o=(t?" message:"+r.sanitizeDiagnosticText(t):"")+(n?" props:"+r.sanitizeDiagnosticText(JSON.stringify(n)):"");this.message+=o}return r.sanitizeDiagnosticText=function(e){return'"'+e.replace(/\"/g,"")+'"'},r.dataType="MessageData",r.AiNonUserActionablePrefix="AI (Internal): ",r.AiUserActionablePrefix="AI: ",r}(),g=function(){function e(e){this.AIInternalMessagePrefix="AITR_",this.enableDebugExceptions=function(){return!1},this.consoleLoggingLevel=function(){return 1},this.telemetryLoggingLevel=function(){return 0},this.maxInternalMessageLimit=function(){return 25},this.queue=[],this._messageCount=0,this._messageLogged={},f.isNullOrUndefined(e)||(f.isNullOrUndefined(e.loggingLevelConsole)||(this.consoleLoggingLevel=function(){return e.loggingLevelConsole}),f.isNullOrUndefined(e.loggingLevelTelemetry)||(this.telemetryLoggingLevel=function(){return e.loggingLevelTelemetry}),f.isNullOrUndefined(e.maxMessageLimit)||(this.maxInternalMessageLimit=function(){return e.maxMessageLimit}),f.isNullOrUndefined(e.enableDebugExceptions)||(this.enableDebugExceptions=function(){return e.enableDebugExceptions}))}return e.prototype.throwInternal=function(e,t,i,n,o){void 0===o&&(o=!1);var r=new l(t,i,o,n);if(this.enableDebugExceptions())throw r;if(void 0!==r&&r&&void 0!==r.message){if(o){var s=+r.messageId;(!this._messageLogged[s]||this.consoleLoggingLevel()>=a.LoggingSeverity.WARNING)&&(this.warnToConsole(r.message),this._messageLogged[s]=!0)}else this.consoleLoggingLevel()>=a.LoggingSeverity.WARNING&&this.warnToConsole(r.message);this.logInternalMessage(e,r)}},e.prototype.warnToConsole=function(e){"undefined"!=typeof console&&console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},e.prototype.resetInternalMessageCount=function(){this._messageCount=0,this._messageLogged={}},e.prototype.logInternalMessage=function(e,t){if(!this._areInternalMessagesThrottled()){var i=!0,n=this.AIInternalMessagePrefix+t.messageId;if(this._messageLogged[n]?i=!1:this._messageLogged[n]=!0,i&&(e<=this.telemetryLoggingLevel()&&(this.queue.push(t),this._messageCount++),this._messageCount==this.maxInternalMessageLimit())){var o="Internal events throttle limit per PageView reached for this app.",r=new l(s.MessageLimitPerPVExceeded,o,!1);this.queue.push(r),this.warnToConsole(o)}}},e.prototype._areInternalMessagesThrottled=function(){return this._messageCount>=this.maxInternalMessageLimit()},e}(),n=function(){function e(){this._isInitialized=!1,this._extensions=new Array,this._channelController=new o}return e.prototype.initialize=function(e,t){var i=this;if(this._isInitialized)throw Error("Core should not be initialized more than once");if(!e||f.isNullOrUndefined(e.instrumentationKey))throw Error("Please provide instrumentation key");if(this.config=e,this._notificationManager=new u,this.config.extensions=f.isNullOrUndefined(this.config.extensions)?[]:this.config.extensions,this.config.extensionConfig=f.isNullOrUndefined(this.config.extensionConfig)?{}:this.config.extensionConfig,this.config.extensionConfig.NotificationManager=this._notificationManager,this.logger=new g(e),t.forEach(function(e){if(f.isNullOrUndefined(e.initialize))throw Error(h)}),0<this.config.extensions.length){var n=!0,o=!1;if(this.config.extensions.forEach(function(e){f.isNullOrUndefined(e)&&(n=!1),e.priority>p&&(o=!0)}),!n)throw Error(h);if(o)throw Error(d)}(s=this._extensions).push.apply(s,[this._channelController].concat(t,this.config.extensions)),this._extensions=this._extensions.sort(function(e,t){var i=e,n=t,o=typeof i.processTelemetry,r=typeof n.processTelemetry;return"function"==o&&"function"==r?i.priority-n.priority:"function"==o&&"function"!=r?1:"function"!=o&&"function"==r?-1:void 0});var r={};this._extensions.forEach(function(e){var t=e;t&&t.priority&&(f.isNullOrUndefined(r[t.priority])?r[t.priority]=t.identifier:i.logger.warnToConsole("Two extensions have same priority"+r[t.priority]+", "+t.identifier))});for(var s,a=-1,l=0;l<this._extensions.length-1;l++){var c=this._extensions[l];if(!c||"function"==typeof c.processTelemetry){if(c.priority===p){a=l+1;break}this._extensions[l].setNextPlugin(this._extensions[l+1])}}if(this._channelController.initialize(this.config,this,this._extensions),this._extensions.forEach(function(e){e&&e.priority<p&&e.initialize(i.config,i,i._extensions)}),a<this._extensions.length&&this._extensions.splice(a),0===this.getTransmissionControls().length)throw new Error("No channels available");this._isInitialized=!0},e.prototype.getTransmissionControls=function(){return this._channelController.ChannelControls},e.prototype.track=function(e){if(null===e)throw this._notifiyInvalidEvent(e),Error("Invalid telemetry item");if(e.baseData&&!e.baseType)throw this._notifiyInvalidEvent(e),Error("Provide data.baseType for data.baseData");e.baseType||(e.baseType="EventData"),e.iKey||(e.iKey=this.config.instrumentationKey),e.time||(e.time=(new Date).toISOString()),f.isNullOrUndefined(e.ver)&&(e.ver="4.0"),this._validateTelmetryItem(e),this._updateSdkVersion(e);for(var t=0;t<this._extensions.length;){if(this._extensions[t].processTelemetry){this._extensions[t].processTelemetry(e);break}t++}},e.prototype.addNotificationListener=function(e){this._notificationManager.addNotificationListener(e)},e.prototype.removeNotificationListener=function(e){this._notificationManager.removeNotificationListener(e)},e.prototype.pollInternalLogs=function(){var i=this,e=this.config.diagnosticLogInterval;return 0<e||(e=1e4),setInterval(function(){var e=i.logger.queue;e.forEach(function(e){var t={name:"InternalMessageId: "+e.messageId,iKey:i.config.instrumentationKey,time:(new Date).toISOString(),baseType:l.dataType,baseData:{message:e.message}};i.track(t)}),e.length=0},e)},e.prototype._validateTelmetryItem=function(e){if(f.isNullOrUndefined(e.name))throw this._notifiyInvalidEvent(e),Error("telemetry name required");if(f.isNullOrUndefined(e.time))throw this._notifiyInvalidEvent(e),Error("telemetry timestamp required");if(f.isNullOrUndefined(e.iKey))throw this._notifiyInvalidEvent(e),Error("telemetry instrumentationKey required")},e.prototype._updateSdkVersion=function(e){e.ext||(e.ext={}),e.ext.sdk||(e.ext.sdk={});for(var t="",i=0;i<this._extensions.length;i++){var n=this._extensions[i];if(n.identifier&&n.version){var o=n.identifier+":"+n.version+";";t=t.concat(o)}}""!=t&&(e.ext.sdk.libVer=t)},e.prototype._notifiyInvalidEvent=function(e){this._notificationManager.eventsDiscarded([e],t.InvalidEvent)},e}(),o=function(){function e(){this.identifier="ChannelControllerPlugin",this.priority=p}return e.prototype.processTelemetry=function(t){this.channelQueue.forEach(function(e){0<e.length&&e[0].processTelemetry(t)})},Object.defineProperty(e.prototype,"ChannelControls",{get:function(){return this.channelQueue},enumerable:!0,configurable:!0}),e.prototype.initialize=function(i,n,o){var r=this;if(this.channelQueue=new Array,i.channels){var s=void 0;i.channels.forEach(function(e){if(e&&0<e.length){if((e=e.sort(function(e,t){return e.priority-t.priority})).forEach(function(e){e.priority<p&&(s=e.identifier),e.initialize(i,n,o)}),s)throw Error(c+s);for(var t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);r.channelQueue.push(e)}})}for(var e=new Array,t=0;t<o.length;t++){var a=o[t];a.priority>p&&e.push(a)}if(0<e.length){(e=e.sort(function(e,t){return e.priority-t.priority})).forEach(function(e){return e.initialize(i,n,o)});for(t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);this.channelQueue.push(e)}},e}(),h="Extensions must provide callback to initialize",d="Channels must be provided through config.channels only",p=500,c="Channel has invalid priority";a.MinChannelPriorty=100,a.EventsDiscardedReason=t,a.AppInsightsCore=n,a.CoreUtils=f,a.NotificationManager=u,a.DiagnosticLogger=g,a._InternalLogMessage=l,a._InternalMessageId=s,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=applicationinsights-core-js.min.js.map
