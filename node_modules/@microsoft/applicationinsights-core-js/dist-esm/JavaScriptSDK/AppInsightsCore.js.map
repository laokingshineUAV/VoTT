{"version":3,"file":"AppInsightsCore.js","sourceRoot":"","sources":["../../src/JavaScriptSDK/AppInsightsCore.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\nimport { IAppInsightsCore } from \"../JavaScriptSDK.Interfaces/IAppInsightsCore\"\r\nimport { IConfiguration } from \"../JavaScriptSDK.Interfaces/IConfiguration\";\r\nimport { ITelemetryPlugin, IPlugin } from \"../JavaScriptSDK.Interfaces/ITelemetryPlugin\";\r\nimport { IChannelControls, MinChannelPriorty } from \"../JavaScriptSDK.Interfaces/IChannelControls\";\r\nimport { ITelemetryItem } from \"../JavaScriptSDK.Interfaces/ITelemetryItem\";\r\nimport { INotificationListener } from \"../JavaScriptSDK.Interfaces/INotificationListener\";\r\nimport { EventsDiscardedReason } from \"../JavaScriptSDK.Enums/EventsDiscardedReason\";\r\nimport { CoreUtils } from \"./CoreUtils\";\r\nimport { NotificationManager } from \"./NotificationManager\";\r\nimport { IDiagnosticLogger } from \"../JavaScriptSDK.Interfaces/IDiagnosticLogger\";\r\nimport { _InternalLogMessage, DiagnosticLogger } from \"./DiagnosticLogger\";\r\n\r\n\"use strict\";\r\n\r\nexport class AppInsightsCore implements IAppInsightsCore {\r\n\r\n    public config: IConfiguration;\r\n    public static defaultConfig: IConfiguration;\r\n    public logger: IDiagnosticLogger;\r\n\r\n    public _extensions: Array<IPlugin>;\r\n    private _notificationManager: NotificationManager;\r\n    private _isInitialized: boolean = false;\r\n    private _channelController: ChannelController;\r\n\r\n    constructor() {\r\n        this._extensions = new Array<IPlugin>();\r\n        this._channelController = new ChannelController();\r\n    }\r\n\r\n    initialize(config: IConfiguration, extensions: IPlugin[]): void {\r\n\r\n        // Make sure core is only initialized once\r\n        if (this._isInitialized) {\r\n            throw Error(\"Core should not be initialized more than once\");\r\n        }\r\n\r\n        if (!config || CoreUtils.isNullOrUndefined(config.instrumentationKey)) {\r\n            throw Error(\"Please provide instrumentation key\");\r\n        }\r\n\r\n        this.config = config;\r\n\r\n        this._notificationManager = new NotificationManager();        \r\n        this.config.extensions = CoreUtils.isNullOrUndefined(this.config.extensions) ? [] : this.config.extensions;\r\n\r\n        // add notification to the extensions in the config so other plugins can access it\r\n        this.config.extensionConfig = CoreUtils.isNullOrUndefined(this.config.extensionConfig) ? {} : this.config.extensionConfig;\r\n        this.config.extensionConfig.NotificationManager = this._notificationManager;\r\n\r\n        this.logger = new DiagnosticLogger(config);\r\n\r\n        // Initial validation\r\n        extensions.forEach((extension: ITelemetryPlugin) => {\r\n            if (CoreUtils.isNullOrUndefined(extension.initialize)) {\r\n                throw Error(validationError);\r\n            }\r\n        });\r\n\r\n        if (this.config.extensions.length > 0) {\r\n            let isValid = true;\r\n            let containsChannels = false;\r\n            this.config.extensions.forEach(item =>\r\n            {\r\n                if (CoreUtils.isNullOrUndefined(item)) {\r\n                    isValid = false;\r\n                }\r\n\r\n                if (item.priority > ChannelControllerPriority) {\r\n                    containsChannels = true;\r\n                }\r\n            });\r\n\r\n            if (!isValid) {\r\n                throw Error(validationError);\r\n            }\r\n\r\n            if (containsChannels) {\r\n                throw Error(validationErrorInExt);\r\n            }\r\n        }\r\n        // Initial validation complete\r\n\r\n        // Concat all available extensions before sorting by priority\r\n        this._extensions.push(this._channelController, ...extensions, ...this.config.extensions);\r\n        this._extensions = this._extensions.sort((a, b) => {\r\n            let extA = (<ITelemetryPlugin>a);\r\n            let extB = (<ITelemetryPlugin>b);\r\n            let typeExtA = typeof extA.processTelemetry;\r\n            let typeExtB = typeof extB.processTelemetry;\r\n            if (typeExtA === 'function' && typeExtB === 'function') {\r\n                return extA.priority - extB.priority;\r\n            }\r\n\r\n            if (typeExtA === 'function' && typeExtB !== 'function') {\r\n                // keep non telemetryplugin specific extensions at start\r\n                return 1;\r\n            }\r\n\r\n            if (typeExtA !== 'function' && typeExtB === 'function') {\r\n                return -1;\r\n            }\r\n        });\r\n        // sort complete\r\n\r\n        // Check if any two extensions have the same priority, then warn to console\r\n        let priority = {};\r\n        this._extensions.forEach(ext => {\r\n            let t = (<ITelemetryPlugin>ext);\r\n            if (t && t.priority) {\r\n                if (!CoreUtils.isNullOrUndefined(priority[t.priority])) {\r\n                    this.logger.warnToConsole(\"Two extensions have same priority\" + priority[t.priority] + \", \" + t.identifier);\r\n                } else {\r\n                    priority[t.priority] = t.identifier; // set a value\r\n                }\r\n            }\r\n        });\r\n\r\n        let c = -1;\r\n        // Set next plugin for all until channel controller\r\n        for (let idx = 0; idx < this._extensions.length - 1; idx++) {\r\n            let curr = <ITelemetryPlugin>(this._extensions[idx]);\r\n            if (curr && typeof curr.processTelemetry !== 'function') {\r\n                // these are initialized only, allowing an entry point for extensions to be initialized when SDK initializes\r\n                continue;\r\n            }\r\n\r\n            if (curr.priority === ChannelControllerPriority) {\r\n                c = idx + 1;\r\n                break; // channel controller will set remaining pipeline\r\n            }\r\n\r\n            (<any>this._extensions[idx]).setNextPlugin(this._extensions[idx + 1]); // set next plugin\r\n        }\r\n\r\n        // initialize channel controller first, this will initialize all channel plugins\r\n        this._channelController.initialize(this.config, this, this._extensions);\r\n\r\n        // initialize remaining regular plugins\r\n        this._extensions.forEach(ext => {\r\n            let e = ext as ITelemetryPlugin;\r\n            if (e && e.priority < ChannelControllerPriority) {\r\n                ext.initialize(this.config, this, this._extensions); // initialize\r\n            }\r\n        });\r\n\r\n        // Remove sender channels from main list\r\n        if (c < this._extensions.length) {\r\n            this._extensions.splice(c);\r\n        }\r\n\r\n        if (this.getTransmissionControls().length === 0) {\r\n            throw new Error(\"No channels available\");\r\n        }\r\n        this._isInitialized = true;\r\n    }\r\n\r\n    getTransmissionControls(): Array<IChannelControls[]> {\r\n       return this._channelController.ChannelControls;\r\n    }\r\n\r\n    track(telemetryItem: ITelemetryItem) {\r\n        if (telemetryItem === null) {\r\n            this._notifiyInvalidEvent(telemetryItem);\r\n            // throw error\r\n            throw Error(\"Invalid telemetry item\");\r\n        }\r\n\r\n        if (telemetryItem.baseData && !telemetryItem.baseType) {\r\n            this._notifiyInvalidEvent(telemetryItem);\r\n            throw Error(\"Provide data.baseType for data.baseData\");\r\n        }\r\n\r\n        if (!telemetryItem.baseType) {\r\n            // Hard coded from Common::Event.ts::Event.dataType\r\n            telemetryItem.baseType = \"EventData\";\r\n        }\r\n\r\n        if (!telemetryItem.iKey) {\r\n            // setup default iKey if not passed in\r\n            telemetryItem.iKey = this.config.instrumentationKey;\r\n        }\r\n        if (!telemetryItem.time) {\r\n            // add default timestamp if not passed in\r\n            telemetryItem.time = new Date().toISOString();\r\n        }\r\n        if (CoreUtils.isNullOrUndefined(telemetryItem.ver)) {\r\n            // CommonSchema 4.0\r\n            telemetryItem.ver = \"4.0\";\r\n        }\r\n\r\n        // do basic validation before sending it through the pipeline\r\n        this._validateTelmetryItem(telemetryItem);\r\n\r\n        this._updateSdkVersion(telemetryItem);\r\n\r\n        // invoke any common telemetry processors before sending through pipeline\r\n        let i = 0;\r\n        while (i < this._extensions.length) {\r\n            if ((<any>this._extensions[i]).processTelemetry) {\r\n                (<any>this._extensions[i]).processTelemetry(telemetryItem); // pass on to first extension that can support processing\r\n                break;\r\n            }\r\n\r\n            i++;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds a notification listener. The SDK calls methods on the listener when an appropriate notification is raised.\r\n     * The added plugins must raise notifications. If the plugins do not implement the notifications, then no methods will be\r\n     * called.\r\n     * @param {INotificationListener} listener - An INotificationListener object.\r\n     */\r\n    addNotificationListener(listener: INotificationListener): void {\r\n        this._notificationManager.addNotificationListener(listener);\r\n    }\r\n\r\n    /**\r\n     * Removes all instances of the listener.\r\n     * @param {INotificationListener} listener - INotificationListener to remove.\r\n     */\r\n    removeNotificationListener(listener: INotificationListener): void {\r\n        this._notificationManager.removeNotificationListener(listener);\r\n    }\r\n\r\n    /**\r\n     * Periodically check logger.queue for\r\n     */\r\n    pollInternalLogs(): number {\r\n        let interval = this.config.diagnosticLogInterval;\r\n        if (!(interval > 0)) {\r\n            interval = 10000;\r\n        }\r\n\r\n        return <any>setInterval(() => {\r\n            const queue: Array<_InternalLogMessage> = this.logger.queue;\r\n\r\n            queue.forEach((logMessage: _InternalLogMessage) => {\r\n                const item: ITelemetryItem = {\r\n                    name: \"InternalMessageId: \" + logMessage.messageId,\r\n                    iKey: this.config.instrumentationKey,\r\n                    time: new Date().toISOString(),\r\n                    baseType: _InternalLogMessage.dataType,\r\n                    baseData: { message: logMessage.message }\r\n                };\r\n\r\n                this.track(item);\r\n            });\r\n            queue.length = 0;\r\n        }, interval);\r\n    }\r\n\r\n    private _validateTelmetryItem(telemetryItem: ITelemetryItem) {\r\n\r\n        if (CoreUtils.isNullOrUndefined(telemetryItem.name)) {\r\n            this._notifiyInvalidEvent(telemetryItem);\r\n            throw Error(\"telemetry name required\");\r\n        }\r\n\r\n        if (CoreUtils.isNullOrUndefined(telemetryItem.time)) {\r\n            this._notifiyInvalidEvent(telemetryItem);\r\n            throw Error(\"telemetry timestamp required\");\r\n        }\r\n\r\n        if (CoreUtils.isNullOrUndefined(telemetryItem.iKey)) {\r\n            this._notifiyInvalidEvent(telemetryItem);\r\n            throw Error(\"telemetry instrumentationKey required\");\r\n        }\r\n    }\r\n\r\n    private _updateSdkVersion(telemetryItem: ITelemetryItem) {\r\n\r\n        if (!telemetryItem.ext) {\r\n            telemetryItem.ext = {};\r\n        }\r\n\r\n        if (!telemetryItem.ext.sdk) {\r\n            telemetryItem.ext.sdk = {};\r\n        }\r\n\r\n        let version = \"\";\r\n        for(let i = 0; i < this._extensions.length; i++ ) {\r\n            let ext = this._extensions[i];\r\n            if (ext.identifier && ext.version) {\r\n                let str = `${ext.identifier}:${ext.version};`;\r\n                version = version.concat(str);\r\n            }\r\n        }\r\n\r\n        if (version != \"\") {\r\n            telemetryItem.ext.sdk['libVer'] = version;\r\n        }\r\n    }\r\n\r\n    private _notifiyInvalidEvent(telemetryItem: ITelemetryItem): void {\r\n        this._notificationManager.eventsDiscarded([telemetryItem], EventsDiscardedReason.InvalidEvent);\r\n    }\r\n}\r\n\r\nclass ChannelController implements ITelemetryPlugin {\r\n\r\n    private channelQueue: Array<IChannelControls[]>;\r\n\r\n    public processTelemetry (item: ITelemetryItem) {\r\n        this.channelQueue.forEach(queues => {\r\n            // pass on to first item in queue\r\n            if (queues.length > 0) {\r\n                queues[0].processTelemetry(item);\r\n            }\r\n        });\r\n    }\r\n\r\n    public get ChannelControls(): Array<IChannelControls[]> {\r\n        return this.channelQueue;\r\n    }\r\n\r\n    identifier: string = \"ChannelControllerPlugin\";\r\n\r\n    setNextPlugin: (next: ITelemetryPlugin) => {}; // channel controller is last in pipeline\r\n\r\n    priority: number = ChannelControllerPriority; // in reserved range 100 to 200\r\n\r\n    initialize(config: IConfiguration, core: IAppInsightsCore, extensions: IPlugin[]) {\r\n        this.channelQueue = new Array<IChannelControls[]>();\r\n        if (config.channels) {\r\n            let invalidChannelIdentifier = undefined;\r\n            config.channels.forEach(queue => {\r\n\r\n                if(queue && queue.length > 0) {\r\n                    queue = queue.sort((a,b) => { // sort based on priority within each queue\r\n                        return a.priority - b.priority;\r\n                    });\r\n\r\n                    // Initialize each plugin\r\n                    queue.forEach(queueItem => {\r\n                        if (queueItem.priority < ChannelControllerPriority) {\r\n                            invalidChannelIdentifier = queueItem.identifier;\r\n                        }\r\n                        queueItem.initialize(config, core, extensions)\r\n                    });\r\n\r\n                    if (invalidChannelIdentifier) {\r\n                        throw Error(ChannelValidationMessage + invalidChannelIdentifier);\r\n                    }\r\n\r\n                    for (let i = 1; i < queue.length; i++) {\r\n                        queue[i - 1].setNextPlugin(queue[i]); // setup processing chain\r\n                    }\r\n\r\n                    this.channelQueue.push(queue);\r\n                }\r\n            });\r\n        }\r\n        \r\n        let arr = new Array<IChannelControls>();\r\n\r\n        for (let i = 0; i < extensions.length; i++) {\r\n            let plugin = <IChannelControls>extensions[i];\r\n            if (plugin.priority > ChannelControllerPriority) {\r\n                arr.push(plugin);\r\n            }\r\n        }\r\n\r\n        if (arr.length > 0) {\r\n            // sort if not sorted\r\n            arr = arr.sort((a,b) => {\r\n                return a.priority - b.priority;\r\n            });\r\n\r\n            // Initialize each plugin\r\n            arr.forEach(queueItem => queueItem.initialize(config, core, extensions));\r\n\r\n            // setup next plugin\r\n            for (let i = 1; i < arr.length; i++) {\r\n                arr[i - 1].setNextPlugin(arr[i]);\r\n            }\r\n\r\n            this.channelQueue.push(arr);\r\n        }        \r\n    }\r\n}\r\n\r\nconst validationError = \"Extensions must provide callback to initialize\";\r\nconst validationErrorInExt = \"Channels must be provided through config.channels only\";\r\nconst ChannelControllerPriority = 500;\r\nconst ChannelValidationMessage = \"Channel has invalid priority\";\r\n"]}