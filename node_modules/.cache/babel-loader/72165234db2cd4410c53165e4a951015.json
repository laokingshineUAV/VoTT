{"ast":null,"code":"import _toConsumableArray from \"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { LocalFileSystemProxy } from \"../../providers/storage/localFileSystemProxy\";\nexport var ElectronProxyHandler =\n/*#__PURE__*/\nfunction () {\n  function ElectronProxyHandler(folderPath) {\n    _classCallCheck(this, ElectronProxyHandler);\n\n    var options = {\n      folderPath: folderPath\n    };\n    this.provider = new LocalFileSystemProxy(options);\n  }\n\n  _createClass(ElectronProxyHandler, [{\n    key: \"load\",\n    value: function () {\n      var _load = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var modelJSON, modelArtifacts, _ref, _ref2, weightSpecs, weightData;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.t0 = JSON;\n                _context.next = 3;\n                return this.provider.readText(\"/model.json\");\n\n              case 3:\n                _context.t1 = _context.sent;\n                modelJSON = _context.t0.parse.call(_context.t0, _context.t1);\n                modelArtifacts = {\n                  modelTopology: modelJSON.modelTopology\n                };\n\n                if (!(modelJSON.weightsManifest != null)) {\n                  _context.next = 15;\n                  break;\n                }\n\n                _context.next = 9;\n                return this.loadWeights(modelJSON.weightsManifest);\n\n              case 9:\n                _ref = _context.sent;\n                _ref2 = _slicedToArray(_ref, 2);\n                weightSpecs = _ref2[0];\n                weightData = _ref2[1];\n                modelArtifacts.weightSpecs = weightSpecs;\n                modelArtifacts.weightData = weightData;\n\n              case 15:\n                return _context.abrupt(\"return\", modelArtifacts);\n\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function load() {\n        return _load.apply(this, arguments);\n      }\n\n      return load;\n    }()\n  }, {\n    key: \"loadClasses\",\n    value: function () {\n      var _loadClasses = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var json;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.provider.readText(\"/classes.json\");\n\n              case 2:\n                json = _context2.sent;\n                return _context2.abrupt(\"return\", json ? JSON.parse(json) : null);\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loadClasses() {\n        return _loadClasses.apply(this, arguments);\n      }\n\n      return loadClasses;\n    }()\n  }, {\n    key: \"loadWeights\",\n    value: function () {\n      var _loadWeights = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(weightsManifest) {\n        var buffers, weightSpecs, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, group, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, shardName, buffer;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                buffers = [];\n                weightSpecs = [];\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context3.prev = 5;\n                _iterator = weightsManifest[Symbol.iterator]();\n\n              case 7:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context3.next = 41;\n                  break;\n                }\n\n                group = _step.value;\n                _iteratorNormalCompletion2 = true;\n                _didIteratorError2 = false;\n                _iteratorError2 = undefined;\n                _context3.prev = 12;\n                _iterator2 = group.paths[Symbol.iterator]();\n\n              case 14:\n                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n                  _context3.next = 23;\n                  break;\n                }\n\n                shardName = _step2.value;\n                _context3.next = 18;\n                return this.provider.readBinary(\"/\" + shardName);\n\n              case 18:\n                buffer = _context3.sent;\n                buffers.push(buffer);\n\n              case 20:\n                _iteratorNormalCompletion2 = true;\n                _context3.next = 14;\n                break;\n\n              case 23:\n                _context3.next = 29;\n                break;\n\n              case 25:\n                _context3.prev = 25;\n                _context3.t0 = _context3[\"catch\"](12);\n                _didIteratorError2 = true;\n                _iteratorError2 = _context3.t0;\n\n              case 29:\n                _context3.prev = 29;\n                _context3.prev = 30;\n\n                if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                  _iterator2.return();\n                }\n\n              case 32:\n                _context3.prev = 32;\n\n                if (!_didIteratorError2) {\n                  _context3.next = 35;\n                  break;\n                }\n\n                throw _iteratorError2;\n\n              case 35:\n                return _context3.finish(32);\n\n              case 36:\n                return _context3.finish(29);\n\n              case 37:\n                weightSpecs.push.apply(weightSpecs, _toConsumableArray(group.weights));\n\n              case 38:\n                _iteratorNormalCompletion = true;\n                _context3.next = 7;\n                break;\n\n              case 41:\n                _context3.next = 47;\n                break;\n\n              case 43:\n                _context3.prev = 43;\n                _context3.t1 = _context3[\"catch\"](5);\n                _didIteratorError = true;\n                _iteratorError = _context3.t1;\n\n              case 47:\n                _context3.prev = 47;\n                _context3.prev = 48;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 50:\n                _context3.prev = 50;\n\n                if (!_didIteratorError) {\n                  _context3.next = 53;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 53:\n                return _context3.finish(50);\n\n              case 54:\n                return _context3.finish(47);\n\n              case 55:\n                return _context3.abrupt(\"return\", [weightSpecs, this.toArrayBuffer(buffers)]);\n\n              case 56:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[5, 43, 47, 55], [12, 25, 29, 37], [30,, 32, 36], [48,, 50, 54]]);\n      }));\n\n      function loadWeights(_x) {\n        return _loadWeights.apply(this, arguments);\n      }\n\n      return loadWeights;\n    }()\n    /**\n     * Convert a Buffer or an Array of Buffers to an ArrayBuffer.\n     *\n     * If the input is an Array of Buffers, they will be concatenated in the\n     * specified order to form the output ArrayBuffer.\n     */\n\n  }, {\n    key: \"toArrayBuffer\",\n    value: function toArrayBuffer(buf) {\n      if (Array.isArray(buf)) {\n        // An Array of Buffers.\n        var totalLength = 0;\n        var _iteratorNormalCompletion3 = true;\n        var _didIteratorError3 = false;\n        var _iteratorError3 = undefined;\n\n        try {\n          for (var _iterator3 = buf[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n            var buffer = _step3.value;\n            totalLength += buffer.length;\n          }\n        } catch (err) {\n          _didIteratorError3 = true;\n          _iteratorError3 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n              _iterator3.return();\n            }\n          } finally {\n            if (_didIteratorError3) {\n              throw _iteratorError3;\n            }\n          }\n        }\n\n        var ab = new ArrayBuffer(totalLength);\n        var view = new Uint8Array(ab);\n        var pos = 0;\n        var _iteratorNormalCompletion4 = true;\n        var _didIteratorError4 = false;\n        var _iteratorError4 = undefined;\n\n        try {\n          for (var _iterator4 = buf[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n            var _buffer = _step4.value;\n            pos += _buffer.copy(view, pos);\n          }\n        } catch (err) {\n          _didIteratorError4 = true;\n          _iteratorError4 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n              _iterator4.return();\n            }\n          } finally {\n            if (_didIteratorError4) {\n              throw _iteratorError4;\n            }\n          }\n        }\n\n        return ab;\n      } else {\n        // A single Buffer. Return a copy of the underlying ArrayBuffer slice.\n        return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n      }\n    }\n  }]);\n\n  return ElectronProxyHandler;\n}();","map":{"version":3,"sources":["/home/jw/Documents/code/VoTT/src/providers/activeLearning/electronProxyHandler.ts"],"names":["LocalFileSystemProxy","ElectronProxyHandler","folderPath","options","provider","JSON","readText","modelJSON","parse","modelArtifacts","modelTopology","weightsManifest","loadWeights","weightSpecs","weightData","json","buffers","group","paths","shardName","readBinary","buffer","push","weights","toArrayBuffer","buf","Array","isArray","totalLength","length","ab","ArrayBuffer","view","Uint8Array","pos","copy","slice","byteOffset","byteLength"],"mappings":";;;;;;AACA,SAASA,oBAAT,QAAmE,8CAAnE;AAEA,WAAaC,oBAAb;AAAA;AAAA;AAGI,gCAAYC,UAAZ,EAAgC;AAAA;;AAC5B,QAAMC,OAAqC,GAAG;AAAED,MAAAA,UAAU,EAAVA;AAAF,KAA9C;AACA,SAAKE,QAAL,GAAgB,IAAIJ,oBAAJ,CAAyBG,OAAzB,CAAhB;AACH;;AANL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,8BAS0BE,IAT1B;AAAA;AAAA,uBAS2C,KAAKD,QAAL,CAAcE,QAAd,CAAuB,aAAvB,CAT3C;;AAAA;AAAA;AAScC,gBAAAA,SATd,eAS+BC,KAT/B;AAWcC,gBAAAA,cAXd,GAWsD;AAC1CC,kBAAAA,aAAa,EAAEH,SAAS,CAACG;AADiB,iBAXtD;;AAAA,sBAeYH,SAAS,CAACI,eAAV,IAA6B,IAfzC;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAiBsB,KAAKC,WAAL,CAAiBL,SAAS,CAACI,eAA3B,CAjBtB;;AAAA;AAAA;AAAA;AAgBmBE,gBAAAA,WAhBnB;AAgBgCC,gBAAAA,UAhBhC;AAkBYL,gBAAAA,cAAc,CAACI,WAAf,GAA6BA,WAA7B;AACAJ,gBAAAA,cAAc,CAACK,UAAf,GAA4BA,UAA5B;;AAnBZ;AAAA,iDAsBeL,cAtBf;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBA0B2B,KAAKL,QAAL,CAAcE,QAAd,CAAuB,eAAvB,CA1B3B;;AAAA;AA0BcS,gBAAAA,IA1Bd;AAAA,kDA2BeA,IAAI,GAAGV,IAAI,CAACG,KAAL,CAAWO,IAAX,CAAH,GAAsB,IA3BzC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDA8B8BJ,eA9B9B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAgCcK,gBAAAA,OAhCd,GAgCkC,EAhClC;AAiCcH,gBAAAA,WAjCd,GAiC2D,EAjC3D;AAAA;AAAA;AAAA;AAAA;AAAA,4BAmC4BF,eAnC5B;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmCmBM,gBAAAA,KAnCnB;AAAA;AAAA;AAAA;AAAA;AAAA,6BAoCoCA,KAAK,CAACC,KApC1C;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAoCuBC,gBAAAA,SApCvB;AAAA;AAAA,uBAqCqC,KAAKf,QAAL,CAAcgB,UAAd,CAAyB,MAAMD,SAA/B,CArCrC;;AAAA;AAqCsBE,gBAAAA,MArCtB;AAsCgBL,gBAAAA,OAAO,CAACM,IAAR,CAAaD,MAAb;;AAtChB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAwCYR,gBAAAA,WAAW,CAACS,IAAZ,OAAAT,WAAW,qBAASI,KAAK,CAACM,OAAf,EAAX;;AAxCZ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA,kDA2Ce,CAACV,WAAD,EAAc,KAAKW,aAAL,CAAmBR,OAAnB,CAAd,CA3Cf;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA8CI;;;;;;;AA9CJ;AAAA;AAAA,kCAoD0BS,GApD1B,EAoD+D;AACvD,UAAIC,KAAK,CAACC,OAAN,CAAcF,GAAd,CAAJ,EAAwB;AACpB;AACA,YAAIG,WAAW,GAAG,CAAlB;AAFoB;AAAA;AAAA;;AAAA;AAGpB,gCAAqBH,GAArB,mIAA0B;AAAA,gBAAfJ,MAAe;AACtBO,YAAAA,WAAW,IAAIP,MAAM,CAACQ,MAAtB;AACH;AALmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOpB,YAAMC,EAAE,GAAG,IAAIC,WAAJ,CAAgBH,WAAhB,CAAX;AACA,YAAMI,IAAI,GAAG,IAAIC,UAAJ,CAAeH,EAAf,CAAb;AACA,YAAII,GAAG,GAAG,CAAV;AAToB;AAAA;AAAA;;AAAA;AAUpB,gCAAqBT,GAArB,mIAA0B;AAAA,gBAAfJ,OAAe;AACtBa,YAAAA,GAAG,IAAIb,OAAM,CAACc,IAAP,CAAYH,IAAZ,EAAkBE,GAAlB,CAAP;AACH;AAZmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAapB,eAAOJ,EAAP;AACH,OAdD,MAcO;AACH;AACA,eAAOL,GAAG,CAACJ,MAAJ,CAAWe,KAAX,CAAiBX,GAAG,CAACY,UAArB,EAAiCZ,GAAG,CAACY,UAAJ,GAAiBZ,GAAG,CAACa,UAAtD,CAAP;AACH;AACJ;AAvEL;;AAAA;AAAA","sourcesContent":["import * as tfc from \"@tensorflow/tfjs-core\";\nimport { LocalFileSystemProxy, ILocalFileSystemProxyOptions } from \"../../providers/storage/localFileSystemProxy\";\n\nexport class ElectronProxyHandler implements tfc.io.IOHandler {\n    protected readonly provider: LocalFileSystemProxy;\n\n    constructor(folderPath: string) {\n        const options: ILocalFileSystemProxyOptions = { folderPath };\n        this.provider = new LocalFileSystemProxy(options);\n    }\n\n    public async load(): Promise<tfc.io.ModelArtifacts> {\n        const modelJSON = JSON.parse(await this.provider.readText(\"/model.json\"));\n\n        const modelArtifacts: tfc.io.ModelArtifacts = {\n            modelTopology: modelJSON.modelTopology,\n        };\n\n        if (modelJSON.weightsManifest != null) {\n            const [weightSpecs, weightData] =\n                await this.loadWeights(modelJSON.weightsManifest);\n            modelArtifacts.weightSpecs = weightSpecs;\n            modelArtifacts.weightData = weightData;\n        }\n\n        return modelArtifacts;\n    }\n\n    public async loadClasses(): Promise<JSON> {\n        const json = await this.provider.readText(\"/classes.json\");\n        return json ? JSON.parse(json) : null;\n    }\n\n    private async loadWeights(weightsManifest: tfc.io.WeightsManifestConfig)\n        : Promise<[tfc.io.WeightsManifestEntry[], ArrayBuffer]> {\n        const buffers: Buffer[] = [];\n        const weightSpecs: tfc.io.WeightsManifestEntry[] = [];\n\n        for (const group of weightsManifest) {\n            for (const shardName of group.paths) {\n                const buffer = await this.provider.readBinary(\"/\" + shardName);\n                buffers.push(buffer);\n            }\n            weightSpecs.push(...group.weights);\n        }\n\n        return [weightSpecs, this.toArrayBuffer(buffers)];\n    }\n\n    /**\n     * Convert a Buffer or an Array of Buffers to an ArrayBuffer.\n     *\n     * If the input is an Array of Buffers, they will be concatenated in the\n     * specified order to form the output ArrayBuffer.\n     */\n    private toArrayBuffer(buf: Buffer | Buffer[]): ArrayBuffer {\n        if (Array.isArray(buf)) {\n            // An Array of Buffers.\n            let totalLength = 0;\n            for (const buffer of buf) {\n                totalLength += buffer.length;\n            }\n\n            const ab = new ArrayBuffer(totalLength);\n            const view = new Uint8Array(ab);\n            let pos = 0;\n            for (const buffer of buf) {\n                pos += buffer.copy(view, pos);\n            }\n            return ab;\n        } else {\n            // A single Buffer. Return a copy of the underlying ArrayBuffer slice.\n            return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}