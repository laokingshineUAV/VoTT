{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/home/jw/Documents/code/VoTT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar TagsComponent_1 = require(\"../Component/TagsComponent\");\n/**\r\n * `TagsComponent` for the `RectRegion` class.\r\n */\n\n\nvar TagsElement =\n/*#__PURE__*/\nfunction (_TagsComponent_1$Tags) {\n  _inherits(TagsElement, _TagsComponent_1$Tags);\n\n  /**\r\n   * Creates a new `TagsElement` object.\r\n   * @param paper - The `Snap.Paper` object to draw on.\r\n   * @param paperRect - The parent bounding box for created component.\r\n   * @param regionData - The `RegionData` object shared across components. Used also for initial setup.\r\n   * @param tags - The `TagsDescriptor` object presenting colors and names for region tags.\r\n   * @param styleId - The unique css style id for region.\r\n   * @param styleSheet - The regerence to the stylesheet object for rules insection.\r\n   * @param tagsUpdateOptions - The settings for redrawing tags.\r\n   */\n  function TagsElement(paper, paperRect, regionData, tags, styleId, styleSheet, tagsUpdateOptions) {\n    var _this;\n\n    _classCallCheck(this, TagsElement);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TagsElement).call(this, paper, paperRect, regionData, tags, styleId, styleSheet, tagsUpdateOptions));\n\n    _this.buildOn(paper, tags);\n\n    return _this;\n  }\n  /**\r\n   * Redraws the componnent.\r\n   */\n\n\n  _createClass(TagsElement, [{\n    key: \"redraw\",\n    value: function redraw() {\n      var _this2 = this;\n\n      var rebuildTags = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      // If there are tags assigned\n      if (this.tags) {\n        window.requestAnimationFrame(function () {\n          if (_this2.tags.primary !== undefined && _this2.tags.primary !== null) {\n            // Update primaty tag rect\n            _this2.primaryTagRect.attr({\n              height: _this2.height,\n              width: _this2.width,\n              x: _this2.x,\n              y: _this2.y\n            }); // Update primary tag text\n\n\n            if (rebuildTags) {\n              _this2.primaryTagText.node.innerHTML = _this2.tags.primary !== null ? _this2.tags.primary.name : \"\";\n              _this2.textBox = _this2.primaryTagText.getBBox();\n            }\n\n            var showTextLabel = _this2.textBox.width + 10 <= _this2.width && _this2.textBox.height <= _this2.height;\n\n            if (showTextLabel) {\n              _this2.primaryTagTextBG.attr({\n                height: _this2.textBox.height + 5,\n                width: _this2.textBox.width + 10,\n                x: _this2.x + 1,\n                y: _this2.y + 1\n              });\n\n              _this2.primaryTagText.attr({\n                visibility: \"visible\",\n                x: _this2.x + 5,\n                y: _this2.y + _this2.textBox.height\n              });\n            } else {\n              _this2.primaryTagTextBG.attr({\n                height: Math.min(10, _this2.height),\n                width: Math.min(10, _this2.width),\n                x: _this2.x,\n                y: _this2.y\n              });\n\n              _this2.primaryTagText.attr({\n                visibility: \"hidden\",\n                x: _this2.x + 5,\n                y: _this2.y + _this2.textBox.height\n              });\n            }\n          } else {\n            _this2.primaryTagRect.attr({\n              height: _this2.height,\n              width: _this2.width,\n              x: _this2.x,\n              y: _this2.y\n            });\n\n            _this2.primaryTagTextBG.attr({\n              height: 0,\n              width: 0\n            });\n\n            _this2.primaryTagText.attr({\n              visibility: \"hidden\",\n              x: _this2.x + 5,\n              y: _this2.y + _this2.textBox.height\n            });\n          } // Clear secondary tags -> redraw from scratch\n\n\n          if (rebuildTags) {\n            _this2.secondaryTags.forEach(function (tag) {\n              tag.remove();\n            });\n\n            _this2.secondaryTags = [];\n          } // Recreate secondary tags\n\n\n          if (_this2.tags.secondary && _this2.tags.secondary.length > 0) {\n            var s = 6;\n            var cx = _this2.x + 0.5 * _this2.boundRect.width;\n            var cy = _this2.y - s - 5;\n            var length = _this2.tags.secondary.length;\n\n            for (var i = 0; i < length; i++) {\n              var stag = _this2.tags.secondary[i];\n              var x = cx + (2 * i - length + 1) * s - s / 2;\n\n              if (rebuildTags) {\n                var tagel = _this2.paper.rect(x, cy, s, s);\n\n                tagel.addClass(\"secondaryTagStyle\");\n                tagel.addClass(\"secondaryTag-\".concat(stag.name));\n\n                _this2.secondaryTagsNode.add(tagel);\n\n                _this2.secondaryTags.push(tagel);\n              } else {\n                var _tagel = _this2.secondaryTags[i];\n\n                _tagel.attr({\n                  x: x,\n                  y: cy\n                });\n              }\n            }\n          }\n        });\n      } else {\n        window.requestAnimationFrame(function () {\n          _this2.primaryTagRect.attr({\n            height: _this2.height,\n            width: _this2.width,\n            x: _this2.x,\n            y: _this2.y\n          }); // Remove primary tag\n\n\n          _this2.primaryTagText.node.innerHTML = \"\";\n\n          _this2.primaryTagTextBG.attr({\n            height: 0,\n            width: 0\n          }); // Clear secondary tags\n\n\n          _this2.secondaryTags.forEach(function (tag) {\n            tag.remove();\n          });\n\n          _this2.secondaryTags = [];\n        });\n      }\n    }\n    /**\r\n     * Inits style maps.\r\n     */\n\n  }, {\n    key: \"initStyleMaps\",\n    value: function initStyleMaps(tags) {\n      var _this3 = this;\n\n      if (tags !== null) {\n        if (tags.primary !== null) {\n          this.styleMap = [{\n            rule: \".\".concat(this.styleId, \" .primaryTagRectStyle\"),\n            style: \"fill: \".concat(tags.primary.colorShadow, \";\\n                                stroke:\").concat(tags.primary.colorAccent, \";\")\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \":hover  .primaryTagRectStyle\"),\n            style: \"fill: \".concat(tags.primary.colorHighlight, \";\\n                                stroke: #fff;\")\n          }, {\n            rule: \".regionStyle.selected.\".concat(this.styleId, \" .primaryTagRectStyle\"),\n            style: \"fill: \".concat(tags.primary.colorHighlight, \";\\n                                stroke:\").concat(tags.primary.colorAccent, \";\")\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .primaryTagTextBGStyle\"),\n            style: \"fill:\".concat(tags.primary.colorAccent, \";\")\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .anchorStyle\"),\n            style: \"stroke:\".concat(tags.primary.colorDark, \";\\n                                fill: \").concat(tags.primary.colorPure)\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \":hover .anchorStyle\"),\n            style: \"stroke:#fff;\"\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .anchorStyle.ghost\"),\n            style: \"fill:transparent;\"\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .anchorStyle.ghost:hover\"),\n            style: \"fill:rgba(255,255,255,0.5);\"\n          }];\n          this.styleLightMap = [{\n            rule: \".\".concat(this.styleId, \" .primaryTagRectStyle\"),\n            style: \"fill: \".concat(tags.primary.colorNoColor, \";\\n                                stroke:\").concat(tags.primary.colorAccent, \";\")\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \":hover  .primaryTagRectStyle\"),\n            style: \"fill: \".concat(tags.primary.colorShadow, \";\\n                                stroke: #fff;\")\n          }, {\n            rule: \".regionStyle.selected.\".concat(this.styleId, \" .primaryTagRectStyle\"),\n            style: \"fill: \".concat(tags.primary.colorShadow, \";\\n                                stroke:\").concat(tags.primary.colorAccent, \";\")\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .primaryTagTextBGStyle\"),\n            style: \"fill:\".concat(tags.primary.colorShadow, \";\")\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .primaryTagTextStyle\"),\n            style: \"opacity:0.25;\"\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .secondaryTagStyle\"),\n            style: \"opacity:0.25;\"\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .anchorStyle\"),\n            style: \"stroke:\".concat(tags.primary.colorDark, \";\\n                                fill: \").concat(tags.primary.colorPure)\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \":hover .anchorStyle\"),\n            style: \"stroke:#fff;\"\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .anchorStyle.ghost\"),\n            style: \"fill:transparent;\"\n          }, {\n            rule: \".regionStyle.\".concat(this.styleId, \" .anchorStyle.ghost:hover\"),\n            style: \"fill:rgba(255,255,255,0.5);\"\n          }];\n        } else {\n          this.styleMap = [];\n          this.styleLightMap = [];\n        }\n\n        if (tags.secondary !== null && tags.secondary !== undefined) {\n          tags.secondary.forEach(function (tag) {\n            var rule = {\n              rule: \".secondaryTagStyle.secondaryTag-\".concat(tag.name),\n              style: \"fill: \".concat(tag.colorAccent, \";\")\n            };\n\n            _this3.styleMap.push(rule);\n\n            _this3.styleLightMap.push(rule);\n          });\n        }\n      }\n    }\n    /**\r\n     * Internal function to recreate tag labels.\r\n     */\n\n  }, {\n    key: \"rebuildTagLabels\",\n    value: function rebuildTagLabels() {\n      this.redraw(true);\n    }\n    /**\r\n     * Internal function to create tag labels\r\n     * @param paper - The `Snap.Paper` object to draw on.\r\n     * @param tags - The `TagsDescriptor` object defining tags.\r\n     */\n\n  }, {\n    key: \"buildOn\",\n    value: function buildOn(paper, tags) {\n      this.primaryTagNode = paper.g();\n      this.primaryTagRect = paper.rect(this.x, this.y, this.boundRect.width, this.boundRect.height);\n      this.primaryTagRect.addClass(\"primaryTagRectStyle\");\n      this.primaryTagText = paper.text(this.x, this.y, \"\");\n      this.primaryTagText.addClass(\"primaryTagTextStyle\");\n      this.textBox = this.primaryTagText.getBBox(); // bound to region???\n\n      this.primaryTagTextBG = paper.rect(this.x, this.y, 0, 0);\n      this.primaryTagTextBG.addClass(\"primaryTagTextBGStyle\");\n      this.primaryTagNode.add(this.primaryTagRect);\n      this.primaryTagNode.add(this.primaryTagTextBG);\n      this.primaryTagNode.add(this.primaryTagText);\n      this.secondaryTagsNode = paper.g();\n      this.secondaryTagsNode.addClass(\"secondatyTagsLayer\");\n      this.secondaryTags = [];\n      this.node.add(this.primaryTagNode);\n      this.node.add(this.secondaryTagsNode);\n      this.initStyleMaps(tags);\n      this.updateTags(tags, this.tagsUpdateOptions);\n    }\n  }]);\n\n  return TagsElement;\n}(TagsComponent_1.TagsComponent);\n\nexports.TagsElement = TagsElement;","map":null,"metadata":{},"sourceType":"script"}